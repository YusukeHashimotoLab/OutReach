<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>iPhone Navigation Test - OutReach</title>
  <link rel="stylesheet" href="all-styles.css">
  <script src="navigation.js" defer></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .test-container {
      padding: 20px;
      max-width: 100%;
      margin: 0 auto;
    }
    
    .device-selector {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .device-btn {
      display: inline-block;
      margin: 5px;
      padding: 8px 16px;
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .device-btn:hover {
      background: #0056CC;
    }
    
    .device-btn.active {
      background: #34C759;
    }
    
    .debug-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 10px;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 9999;
      transform: translateY(100%);
      transition: transform 0.3s ease;
    }
    
    .debug-panel.show {
      transform: translateY(0);
    }
    
    .debug-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: #FF3B30;
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 12px;
      cursor: pointer;
      z-index: 10000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    
    .test-content {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .touch-test-area {
      background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
      padding: 40px 20px;
      text-align: center;
      border-radius: 8px;
      margin: 20px 0;
      border: 2px solid #ddd;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-ok { background: #34C759; }
    .status-warning { background: #FF9500; }
    .status-error { background: #FF3B30; }
  </style>
</head>
<body>
  <!-- Navigation Header (will be enhanced by navigation.js) -->
  <header>
    <div class="header-content">
      <h1>iPhone Test - 橋本佑介</h1>
      <nav role="navigation" aria-label="Main navigation">
        <a href="index.html">ホーム</a>
        <a href="research.html">研究</a>
        <a href="publications.html">論文</a>
        <a href="talks.html">発表</a>
        <a href="contact.html">連絡先</a>
      </nav>
    </div>
  </header>

  <main class="test-container">
    <div class="device-selector">
      <h3>📱 iPhone モデル選択</h3>
      <button class="device-btn" data-width="375" data-height="667" data-name="iPhone SE">iPhone SE</button>
      <button class="device-btn" data-width="375" data-height="812" data-name="iPhone 12 mini">iPhone 12 mini</button>
      <button class="device-btn active" data-width="390" data-height="844" data-name="iPhone 12">iPhone 12</button>
      <button class="device-btn" data-width="428" data-height="926" data-name="iPhone 12 Pro Max">iPhone 12 Pro Max</button>
      <button class="device-btn" data-width="393" data-height="852" data-name="iPhone 14">iPhone 14</button>
      <button class="device-btn" data-width="430" data-height="932" data-name="iPhone 14 Pro Max">iPhone 14 Pro Max</button>
    </div>

    <div class="test-content">
      <h2>🧪 ナビゲーションテスト</h2>
      <p>右上のハンバーガーメニューをタップして、各ページへの遷移をテストしてください。</p>
      
      <div id="test-results">
        <h3>テスト結果:</h3>
        <div id="nav-status">
          <span class="status-indicator status-warning"></span>
          ナビゲーション: 待機中...
        </div>
        <div id="touch-status">
          <span class="status-indicator status-warning"></span>
          タッチイベント: 待機中...
        </div>
        <div id="performance-status">
          <span class="status-indicator status-warning"></span>
          パフォーマンス: 待機中...
        </div>
      </div>
    </div>

    <div class="touch-test-area" id="touchTestArea">
      <h3>👆 タッチテストエリア</h3>
      <p>この領域をタッチしてイベントを確認</p>
      <div id="touch-info">タッチを待機中...</div>
    </div>

    <div class="test-content">
      <h3>📊 デバイス情報</h3>
      <div id="device-info">
        <p><strong>画面サイズ:</strong> <span id="screen-size">-</span></p>
        <p><strong>ビューポート:</strong> <span id="viewport-size">-</span></p>
        <p><strong>User Agent:</strong> <span id="user-agent">-</span></p>
        <p><strong>タッチサポート:</strong> <span id="touch-support">-</span></p>
        <p><strong>iOS Safari:</strong> <span id="ios-safari">-</span></p>
      </div>
    </div>
  </main>

  <!-- Debug Panel -->
  <div class="debug-panel" id="debugPanel">
    <div id="debug-log">Debug Log:<br/></div>
  </div>
  <button class="debug-toggle" id="debugToggle" onclick="toggleDebug()">DEBUG</button>

  <script>
    // Debug logging
    let debugLog = [];
    
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      debugLog.push(logEntry);
      
      const debugElement = document.getElementById('debug-log');
      if (debugElement) {
        debugElement.innerHTML = 'Debug Log:<br/>' + debugLog.slice(-10).join('<br/>');
      }
      
      console.log(logEntry);
    }
    
    function toggleDebug() {
      const panel = document.getElementById('debugPanel');
      panel.classList.toggle('show');
    }
    
    // Device simulation
    function setDeviceSize(width, height, name) {
      // Remove active class from all buttons
      document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('active'));
      
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Update viewport simulation (visual feedback)
      log(`Device switched to: ${name} (${width}x${height})`);
      updateDeviceInfo();
    }
    
    // Touch event testing
    function setupTouchTesting() {
      const touchArea = document.getElementById('touchTestArea');
      const touchInfo = document.getElementById('touch-info');
      let startTime, startX, startY;
      
      touchArea.addEventListener('touchstart', (e) => {
        startTime = Date.now();
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        touchInfo.textContent = 'タッチ開始...';
        log(`Touch start at (${Math.round(startX)}, ${Math.round(startY)})`);
        updateTestStatus('touch-status', 'warning', 'タッチイベント: 開始');
      }, { passive: true });
      
      touchArea.addEventListener('touchmove', (e) => {
        const currentX = e.touches[0].clientX;
        const currentY = e.touches[0].clientY;
        const deltaX = Math.abs(currentX - startX);
        const deltaY = Math.abs(currentY - startY);
        touchInfo.textContent = `移動中... Δ(${Math.round(deltaX)}, ${Math.round(deltaY)})`;
        
        if (deltaX > 20 || deltaY > 20) {
          log(`Touch moved: Δ(${Math.round(deltaX)}, ${Math.round(deltaY)}) - would cancel navigation`);
        }
      }, { passive: true });
      
      touchArea.addEventListener('touchend', (e) => {
        const endTime = Date.now();
        const duration = endTime - startTime;
        touchInfo.textContent = `タッチ終了 (${duration}ms)`;
        log(`Touch end after ${duration}ms`);
        updateTestStatus('touch-status', 'ok', 'タッチイベント: 正常');
      }, { passive: true });
    }
    
    // Navigation testing
    function setupNavigationTesting() {
      // Monitor navigation clicks
      document.addEventListener('click', (e) => {
        if (e.target.tagName === 'A' && e.target.closest('nav')) {
          const href = e.target.getAttribute('href') || '#';
          log(`Navigation link clicked: ${href}`);
          updateTestStatus('nav-status', 'ok', 'ナビゲーション: リンククリック検出');
          
          // Prevent actual navigation for testing
          if (href !== '#' && !href.startsWith('http')) {
            e.preventDefault();
            log(`Navigation prevented for testing: ${href}`);
          }
        }
      });
      
      // Monitor mobile menu toggle
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('nav-toggle') || e.target.closest('.nav-toggle')) {
          log('Mobile menu toggle clicked');
          setTimeout(() => {
            const nav = document.querySelector('nav[role="navigation"]');
            const isOpen = nav && nav.classList.contains('nav--open');
            updateTestStatus('nav-status', isOpen ? 'ok' : 'warning', 
              `ナビゲーション: メニュー${isOpen ? '開' : '閉'}`);
          }, 100);
        }
      });
    }
    
    function updateTestStatus(elementId, status, message) {
      const element = document.getElementById(elementId);
      if (element) {
        const indicator = element.querySelector('.status-indicator');
        indicator.className = `status-indicator status-${status}`;
        element.innerHTML = `<span class="status-indicator status-${status}"></span>${message}`;
      }
    }
    
    function updateDeviceInfo() {
      document.getElementById('screen-size').textContent = 
        `${screen.width}x${screen.height}`;
      document.getElementById('viewport-size').textContent = 
        `${window.innerWidth}x${window.innerHeight}`;
      document.getElementById('user-agent').textContent = 
        navigator.userAgent.substring(0, 50) + '...';
      document.getElementById('touch-support').textContent = 
        'ontouchstart' in window ? '✅ サポート' : '❌ 非サポート';
      
      const isIOSSafari = /iPhone|iPad|iPod/.test(navigator.userAgent) && 
                         /Safari/.test(navigator.userAgent) && 
                         !/Chrome|CriOS|FxiOS/.test(navigator.userAgent);
      document.getElementById('ios-safari').textContent = 
        isIOSSafari ? '✅ iOS Safari' : '❌ 他のブラウザ';
    }
    
    // Performance monitoring
    function monitorPerformance() {
      const startTime = performance.now();
      
      window.addEventListener('load', () => {
        const loadTime = performance.now() - startTime;
        log(`Page load time: ${Math.round(loadTime)}ms`);
        updateTestStatus('performance-status', loadTime < 1000 ? 'ok' : 'warning',
          `パフォーマンス: 読み込み${Math.round(loadTime)}ms`);
      });
      
      // Monitor JavaScript errors
      window.addEventListener('error', (e) => {
        log(`JavaScript Error: ${e.message}`);
        updateTestStatus('performance-status', 'error', 'パフォーマンス: JSエラー発生');
      });
    }
    
    // Device button event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Setup device buttons
      document.querySelectorAll('.device-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const width = btn.dataset.width;
          const height = btn.dataset.height;
          const name = btn.dataset.name;
          setDeviceSize(width, height, name);
        });
      });
      
      // Initialize testing
      setupTouchTesting();
      setupNavigationTesting();
      monitorPerformance();
      updateDeviceInfo();
      
      log('iPhone Navigation Test initialized');
      
      // Initial device info update
      setTimeout(updateDeviceInfo, 1000);
    });
  </script>
</body>
</html>